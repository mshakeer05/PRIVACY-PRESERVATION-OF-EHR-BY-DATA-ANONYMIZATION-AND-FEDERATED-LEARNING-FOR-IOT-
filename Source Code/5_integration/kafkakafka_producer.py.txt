from kafka import KafkaProducer
import json
import numpy as np
import time

producer = KafkaProducer(
    bootstrap_servers='localhost:9092',
    value_serializer=lambda v: json.dumps(v).encode('utf-8')
)

for i in range(5):
    weights = {
        "client_id": i,
        "weights": {
            "layer1": np.random.rand(3).tolist(),
            "layer2": np.random.rand(3).tolist(),
            "bias1": [np.random.rand()],
            "bias2": [np.random.rand()]
        }
    }
    producer.send("federated_weights", weights)
    print(f"[Kafka-Producer] Sent model from client-{i}")
    time.sleep(2)
